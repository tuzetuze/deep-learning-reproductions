# STM32F103C8T6 硬件配置指南

## 📌 开发板介绍

### STM32F103C8T6 "蓝丸板" 规格

| 参数 | 规格 |
|------|------|
| 内核 | ARM Cortex-M3 |
| 主频 | 72MHz |
| Flash | 64KB (实际可能有 128KB) |
| SRAM | 20KB |
| GPIO | 37个 |
| 定时器 | 4个16位 + 2个看门狗 |
| USART | 3个 |
| SPI | 2个 |
| I2C | 2个 |
| ADC | 2个12位 (10通道) |
| USB | 1个全速设备 |
| 工作电压 | 2.0V - 3.6V |
| 封装 | LQFP48 |

## 🔌 引脚定义

### 电源引脚
```
VDD / 3.3V  - 电源正极 (3.3V)
GND         - 电源地
VBAT        - 备用电池输入 (RTC)
VDD_A       - 模拟电源 (ADC)
```

### 时钟引脚
```
OSC_IN  (PD0) - 外部晶振输入 (8MHz)
OSC_OUT (PD1) - 外部晶振输出
```

### 启动配置
```
BOOT0 - 启动模式选择
  ├─ GND (0)    → 从主 Flash 启动 (正常运行)
  ├─ 3.3V (1)   → 从系统存储器启动 (ISP 模式)
  └─ BOOT1 (PB2) 配合使用
```

### 调试接口
```
SWDIO (PA13) - 串行数据输入输出
SWCLK (PA14) - 串行时钟
NRST         - 复位引脚 (低电平复位)
```

### 常用外设引脚

#### USART1 (APB2 总线 - 72MHz)
```
PA9  - TX (发送)
PA10 - RX (接收)
```

#### USART2 (APB1 总线 - 36MHz)
```
PA2  - TX
PA3  - RX
```

#### USART3 (APB1 总线 - 36MHz)
```
PB10 - TX
PB11 - RX
```

#### SPI1 (APB2 总线)
```
PA5  - SCK  (时钟)
PA6  - MISO (主入从出)
PA7  - MOSI (主出从入)
PA4  - NSS  (片选)
```

#### SPI2 (APB1 总线)
```
PB13 - SCK
PB14 - MISO
PB15 - MOSI
PB12 - NSS
```

#### I2C1 (APB1 总线)
```
PB6  - SCL (时钟)
PB7  - SDA (数据)
```

#### I2C2 (APB1 总线)
```
PB10 - SCL
PB11 - SDA
```

#### ADC 通道
```
PA0  - ADC1_IN0
PA1  - ADC1_IN1
PA2  - ADC1_IN2
PA3  - ADC1_IN3
PA4  - ADC1_IN4
PA5  - ADC1_IN5
PA6  - ADC1_IN6
PA7  - ADC1_IN7
PB0  - ADC1_IN8
PB1  - ADC1_IN9
```

#### 板载 LED
```
PC13 - 板载 LED (低电平点亮)
```

## 🔧 最小系统接线

### 基本电源连接
```
[3.3V 电源]
    ↓
   VDD ────────┐
   VDD_A ──────┤
              ┌┴┐
              │ │ 100nF 去耦电容
              └┬┘
   GND ────────┤
              ─┴─
```

### 晶振电路
```
         8MHz
      ┌────────┐
OSC_IN│        │OSC_OUT
──────┤        ├──────
      │        │
     ┌┴┐      ┌┴┐
20pF │ │      │ │ 20pF
     └┬┘      └┬┘
     ─┴────────┴─
       GND
```

### 复位电路
```
    3.3V
      │
     ┌┴┐
10kΩ │ │ 上拉电阻
     └┬┘
      ├─── NRST
      │
     ┌┴┐
     │ │ 按键
     └┬┘
      │
     GND
```

### BOOT 配置
```
BOOT0 ──┬── GND (正常运行)
        └── 跳线帽可选 3.3V (ISP 下载)
```

## 🛠️ 编程器连接

### ST-Link V2 连接
```
ST-Link V2          STM32F103
┌─────────┐       ┌──────────┐
│  SWDIO  ├───────┤  PA13    │
│  SWCLK  ├───────┤  PA14    │
│  GND    ├───────┤  GND     │
│  3.3V   ├───────┤  3.3V    │ (可选供电)
└─────────┘       └──────────┘
```

**注意事项：**
- 如果开发板已有独立供电，建议不连接 3.3V
- 确保共地 (GND 必须连接)
- SWDIO/SWCLK 不要接错

### USB 转 TTL (UART 调试)
```
USB-TTL            STM32F103
┌─────────┐       ┌──────────┐
│  TX     ├───────┤  PA10(RX)│  交叉连接
│  RX     ├───────┤  PA9(TX) │  交叉连接
│  GND    ├───────┤  GND     │
└─────────┘       └──────────┘
```

**注意事项：**
- TX 和 RX 要交叉连接
- 不要连接 USB-TTL 的 VCC 到 3.3V (可能冲突)
- 波特率设置为 115200

## 💡 LED 连接示例

### 外接 LED
```
     PC13
       │
      ┌┴┐
330Ω │ │ 限流电阻
      └┬┘
       ├─── LED (+)
       │
      ─┴─
      GND
```

## 🎛️ 按键连接示例

### 外部按键 (下拉)
```
    3.3V
      │
     ┌┴┐
     │ │ 按键
     └┬┘
      ├─── PA0
     ┌┴┐
10kΩ │ │ 下拉电阻
     └┬┘
      │
     GND
```

## 📡 常见传感器连接

### DHT11 温湿度传感器
```
DHT11          STM32
┌────┐       ┌─────┐
│ VCC├───────┤ 3.3V│
│ DAT├───────┤ PA0 │ (任意 GPIO)
│ NC │       │     │
│ GND├───────┤ GND │
└────┘       └─────┘

DAT 引脚需要 4.7kΩ 上拉电阻到 VCC
```

### HC-SR04 超声波传感器
```
HC-SR04        STM32
┌─────┐      ┌─────┐
│ VCC ├──────┤ 5V  │ (需要 5V)
│ TRIG├──────┤ PA1 │
│ ECHO├──────┤ PA2 │
│ GND ├──────┤ GND │
└─────┘      └─────┘

注意：ECHO 输出 5V，最好加分压电阻
```

### OLED 显示屏 (I2C)
```
OLED           STM32
┌────┐       ┌─────┐
│ VCC├───────┤ 3.3V│
│ GND├───────┤ GND │
│ SCL├───────┤ PB6 │ (I2C1_SCL)
│ SDA├───────┤ PB7 │ (I2C1_SDA)
└────┘       └─────┘

SCL/SDA 需要 4.7kΩ 上拉电阻
```

## 🔋 供电方案

### 方案 1: USB 供电
```
Micro USB → 5V → AMS1117-3.3 → 3.3V
                                 ↓
                            STM32 VDD
```

### 方案 2: 外部 5V 供电
```
5V 电源 → AMS1117-3.3 → 3.3V → STM32
```

### 方案 3: 3.7V 锂电池
```
3.7V 锂电池 → LDO 3.3V → STM32
```

### 方案 4: ST-Link 供电
```
ST-Link 3.3V → STM32 VDD
(仅适合调试，电流限制 ~100mA)
```

## ⚠️ 重要注意事项

### 电压警告
- ❌ **绝对不要**给 GPIO 输入超过 3.6V！
- ✅ STM32F103 的 GPIO 是 **5V 容忍** 的（仅限输入）
- ✅ 推荐所有信号电平为 3.3V

### 电流限制
- 单个 GPIO 最大输出电流: 25mA
- 单个 GPIO 推荐输出电流: 8mA
- 所有 GPIO 总电流: ≤150mA

### 时钟注意事项
- HSE 晶振通常为 8MHz
- 确保晶振匹配负载电容 (通常 20pF)
- 如果时钟不稳定，检查晶振和电容

### 调试问题
- 如果无法连接：检查 SWDIO/SWCLK 连接
- 如果无法烧录：检查 BOOT0 是否正确配置
- 复位后无反应：检查晶振电路

## 🧪 测试检查清单

烧录程序前，请确认：

- [ ] 3.3V 供电正常
- [ ] GND 已连接
- [ ] BOOT0 接 GND (正常运行模式)
- [ ] 晶振已安装且有 20pF 电容
- [ ] 复位电路有 10kΩ 上拉
- [ ] ST-Link 连接正确 (SWDIO, SWCLK, GND)
- [ ] LED 正确连接到 PC13
- [ ] UART TX/RX 没有接反

## 📚 参考资料

- [STM32F103C8 数据手册](https://www.st.com/resource/en/datasheet/stm32f103c8.pdf)
- [STM32F103 参考手册](https://www.st.com/resource/en/reference_manual/cd00171190.pdf)
- [蓝丸板原理图](常见的开源资料)

---

**提示：** 硬件连接前务必断电，避免短路和静电损坏！

